(()=>{function a(){return typeof browser<"u"&&typeof browser.runtime<"u"}function l(){return a()?browser:typeof chrome<"u"?chrome:null}function E(e){let t=l();return t?.storage?.local?a()?t.storage.local.get(e):new Promise(n=>{t.storage.local.get(e,r=>n(r||{}))}):Promise.resolve({})}function f(e){let t=l();return t?.storage?.local?a()?t.storage.local.set(e):new Promise(n=>{t.storage.local.set(e,()=>n())}):Promise.resolve()}function w(e){let t=l();return t?.tabs?.query?a()?t.tabs.query(e):new Promise(n=>{t.tabs.query(e,r=>n(r||[]))}):Promise.resolve([])}function P(e,t){let n=l();return n?.tabs?.sendMessage?a()?n.tabs.sendMessage(e,t):new Promise((r,k)=>{n.tabs.sendMessage(e,t,v=>{n.runtime.lastError?k(new Error(n.runtime.lastError.message)):r(v)})}):Promise.reject(new Error("tabs API unavailable"))}var c=document.getElementById("btnCopy"),i=document.getElementById("btnDocx"),d=document.getElementById("btnPdf"),m=document.getElementById("mathMode"),h=document.getElementById("showButtons"),g=document.getElementById("darkThemeDocx"),y=document.getElementById("status"),p=document.getElementById("statusText"),b=document.getElementById("notification");E(["mathMode","showButtons","darkThemeDocx"]).then(e=>{e.mathMode&&(m.value=e.mathMode),e.showButtons!==void 0&&(h.checked=e.showButtons),e.darkThemeDocx!==void 0&&(g.checked=e.darkThemeDocx)}).catch(()=>{});m.addEventListener("change",()=>{f({mathMode:m.value}),u({type:"settingsChanged",settings:x()})});h.addEventListener("change",()=>{f({showButtons:h.checked}),u({type:"settingsChanged",settings:x()})});g.addEventListener("change",()=>{f({darkThemeDocx:g.checked})});function x(){return{mathMode:m.value,showButtons:h.checked,darkThemeDocx:g.checked}}async function B(){try{let t=(await w({active:!0,currentWindow:!0}))[0];t&&(t.url?.includes("chatgpt.com")||t.url?.includes("chat.openai.com"))?(y.className="status status-ok",p.textContent="\u0420\u0430\u0441\u0448\u0438\u0440\u0435\u043D\u0438\u0435 \u0430\u043A\u0442\u0438\u0432\u043D\u043E \u043D\u0430 ChatGPT",c.disabled=!1,i.disabled=!1,d.disabled=!1):(y.className="status status-error",p.textContent="\u041E\u0442\u043A\u0440\u043E\u0439\u0442\u0435 ChatGPT \u0434\u043B\u044F \u0440\u0430\u0431\u043E\u0442\u044B",c.disabled=!0,i.disabled=!0,d.disabled=!0)}catch{y.className="status status-error",p.textContent="\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u043E\u0432\u0435\u0440\u043A\u0438 \u0441\u0442\u0430\u0442\u0443\u0441\u0430"}}B();async function u(e){try{let n=(await w({active:!0,currentWindow:!0}))[0];if(!n)throw new Error("No active tab");return await P(n.id,e)}catch(t){throw s("\u041E\u0448\u0438\u0431\u043A\u0430: \u043E\u0431\u043D\u043E\u0432\u0438\u0442\u0435 \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443 ChatGPT","error"),t}}function s(e,t="success"){b.textContent=e,b.className=`notification ${t}`,setTimeout(()=>{b.className="notification hidden"},3e3)}function o(e,t){e.classList.toggle("loading",t),e.disabled=t}c.addEventListener("click",async()=>{o(c,!0);try{let e=await u({type:"copyForWord"});e?.success?s("\u2713 \u0421\u043A\u043E\u043F\u0438\u0440\u043E\u0432\u0430\u043D\u043E! \u0412\u0441\u0442\u0430\u0432\u044C\u0442\u0435 \u0432 Word (Ctrl+V)","success"):s(e?.error||"\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0441\u043A\u043E\u043F\u0438\u0440\u043E\u0432\u0430\u0442\u044C","error")}catch(e){console.error(e)}finally{o(c,!1)}});i.addEventListener("click",async()=>{o(i,!0);try{let e=await u({type:"exportDocx",settings:x()});e?.success?s("\u2713 DOCX \u0444\u0430\u0439\u043B \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043D","success"):s(e?.error||"\u041E\u0448\u0438\u0431\u043A\u0430 \u044D\u043A\u0441\u043F\u043E\u0440\u0442\u0430 DOCX","error")}catch(e){console.error(e)}finally{o(i,!1)}});d.addEventListener("click",async()=>{o(d,!0);try{let e=await u({type:"exportPdf"});e?.success?s("\u2713 PDF \u0444\u0430\u0439\u043B \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043D","success"):s(e?.error||"\u041E\u0448\u0438\u0431\u043A\u0430 \u044D\u043A\u0441\u043F\u043E\u0440\u0442\u0430 PDF","error")}catch(e){console.error(e)}finally{o(d,!1)}});})();
